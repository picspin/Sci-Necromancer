# Implementation Plan

- [x] 1. Core infrastructure setup (COMPLETED)
  - File processing service with PDF and DOCX support implemented
  - Export service with PDF, DOCX, and JSON formats working
  - Database service with localStorage and Supabase integration complete
  - Error handling framework with boundaries and retry logic in place
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 3.2, 3.3, 3.4, 3.5, 5.1, 5.2, 5.3, 5.4, 5.5, 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 2. Create PDF and DOCX processing modules
  - Create `lib/file/file-process/pdf.ts` module with `parsePdf` function
  - Create `lib/file/file-process/docx.ts` module with `parseDocx` function
  - Implement error types `PdfParseError` and `DocxParseError`
  - Use `pdf-parse` library for PDF text extraction
  - Use `mammoth` library for DOCX parsing
  - Add proper error handling for corrupted or encrypted files
  - _Requirements: 1.1, 1.2, 1.3_

- [-] 3. Implement LLM provider functions
  - Complete `lib/llm/gemini.ts` with actual Gemini API calls
  - Complete `lib/llm/openai.ts` with actual OpenAI API compatible calls
      - this is designed for Open AI API based model provider who can provide text model and Vison language model
  - Implement `analyzeContent` to extract categories and keywords
  - Implement `suggestAbstractType` with Occam's Razor classification
  - Implement `generateFinalAbstract` with spec-compliant output
  - Implement `generateCreativeAbstract` for creative mode
  - Implement `generateImage` for DALL-E 3 and Gemini image generation
  - Add structured output using function calling for consistent responses
  - _Requirements: 2.1, 2.2, 2.3, 4.1, 4.2, 4.3, 4.4_

- [x] 3.1 Create prompt system and guideline router
  - Create `lib/llm/prompts/ismrmPrompts.ts` with analysis and classification prompts
  - Load guideline files from `public/` directory
  - Implement Occam's Razor classification logic
  - Create routing rules based on categories (body/neuro → Clinical Practice, etc.)
  - Implement probability calculation with ≥30% threshold
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [-] 3.2 Implement writing style enhancement
  - Add writing style configuration to prompts
  - Implement AI tone elimination rules
  - Add prohibited phrase detection ("It is worth noting", etc.)
  - Ensure natural rhythm and clear subjects in generated text
  - _Requirements: 4.5_

- [ ] 4. Build ISMRMPanel component
  - Create complete `components/ISMRMPanel.tsx` implementation
  - Implement file upload with PDF/DOCX processing integration
  - Add category and keyword selection popup with color coding
  - Create abstract type suggestion popup with probability display
  - Implement loading animations with step-by-step progress
  - Add abstract generation workflow (analyze → suggest → generate)
  - Integrate with export service for PDF/DOCX/JSON downloads
  - Integrate with database service for saving abstracts
  - _Requirements: 1.4, 1.5, 3.4, 3.5, 7.1, 7.2, 7.3, 7.4, 7.5, 8.3, 8.4_

- [ ] 5. Complete RSNA and JACC panel implementations
  - Finish `components/RSNAPanel.tsx` implementation (currently truncated)
  - Finish `components/JACCPanel.tsx` implementation (currently truncated)
  - Add conference-specific guideline loading
  - Implement conference-specific validation rules
  - Ensure export templates match conference requirements
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 6. Fix type definitions and data models
  - Update `SavedAbstract` interface to include missing fields (abstractType, categories, keywords, userId)
  - Update `DatabaseService` interface to match implementation (add updateAbstract, getSyncStatus)
  - Add `SyncStatus`, `ConflictResolution`, and `GenerationParameters` interfaces
  - Fix `AbstractData` to support optional `abstract` field for full abstract body
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 7. Complete AbstractManager component
  - Finish `components/AbstractManager.tsx` implementation (currently truncated)
  - Add missing `isVisible` prop or state management
  - Implement delete confirmation dialog
  - Add export/import functionality for backup
  - Display sync status for cloud-enabled users
  - _Requirements: 8.3, 8.4_

- [ ] 8. Fix workflowService compilation errors
  - Remove unused imports from `lib/llm/workflowService.ts`
  - Create missing `lib/llm/prompts/ismrmPrompts.ts` file
  - Fix `AbstractData` type to support `abstract` field
  - Update method signatures to match actual usage
  - _Requirements: 2.1, 2.3, 4.1, 4.2_

- [ ] 9. Improve accessibility and user experience
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 9.1 Implement accessibility features
  - Add ARIA labels to all interactive components
  - Create semantic HTML structure for screen readers
  - Implement proper focus management and tab order
  - Add ARIA live regions for dynamic content updates
  - _Requirements: 7.1, 7.2_

- [ ] 9.2 Add keyboard navigation support
  - Enable full keyboard navigation for popups and forms
  - Add keyboard shortcuts for common actions (Escape to close, Enter to submit)
  - Create visible focus indicators throughout the interface (3px outline)
  - Implement focus trapping in modals
  - _Requirements: 7.2, 7.4_

- [ ] 9.3 Create responsive design improvements
  - Add high contrast mode toggle in settings
  - Implement responsive layouts for mobile and tablet
  - Create adaptive font sizing and spacing (support 200% zoom)
  - Ensure minimum 44x44px touch targets
  - _Requirements: 7.3, 7.5_

- [ ] 9.4 Add help system and tooltips
  - Create contextual help text for complex features
  - Add tooltips for all buttons and interactive elements
  - Implement guided tour for new users
  - Add searchable help documentation
  - _Requirements: 7.4, 7.5_

- [ ]* 10. Create comprehensive test suite
  - Write unit tests for all service modules
  - Add integration tests for API interactions and workflows
  - Create end-to-end tests for complete user journeys
  - Implement snapshot tests for UI consistency
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 10.1 Setup testing infrastructure
  - Install Jest, React Testing Library, and Playwright
  - Configure test environment and mock setup
  - Add test scripts to package.json
  - Configure MSW for API mocking
  - _Requirements: 6.1_

- [ ]* 10.2 Write unit tests for services
  - Test file processing modules with mock files
  - Add LLM provider tests with API mocking
  - Create database service tests with localStorage mocking
  - Test export service with format validation
  - _Requirements: 6.1_

- [ ]* 10.3 Add integration tests
  - Test complete abstract generation workflow
  - Add file upload and processing integration tests
  - Create export functionality integration tests
  - Test provider switching and fallback mechanisms
  - _Requirements: 6.2_

- [ ]* 10.4 Implement end-to-end tests
  - Create complete user journey tests using Playwright
  - Add error recovery and fallback testing
  - Test accessibility compliance and keyboard navigation
  - Test offline/online sync scenarios
  - _Requirements: 6.3, 6.5_

- [ ]* 10.5 Add UI snapshot tests
  - Create component snapshot tests for consistency
  - Add visual regression testing for popups and animations
  - Test responsive design across different screen sizes
  - _Requirements: 6.4_